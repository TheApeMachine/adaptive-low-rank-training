{"type":"meta","step":0,"env":{"time":"2025-12-18T12:36:49+01:00","python":"3.12.12 (main, Oct  9 2025, 11:07:00) [Clang 17.0.0 (clang-1700.0.13.3)]","platform":"macOS-15.6-arm64-arm-64bit","torch":"2.9.1","device":"mps","triton_available":false},"argv":["v29_transformer_decoupled_bottleneck_instrumented.py","--mode","train","--size","1b","--exp","train_decoupled_fast","--data","fineweb_1b.npy","--data-format","npy","--vocab-size","50257","--steps","50","--eval-every","0","--analysis-every","0","--instrument","basic","--log-every","1","--batch-size","32","--grad-accum","2","--train-seq-len","512","--opt-foreach"],"args":{"size":"1b","exp":"train_decoupled_fast","run_root":"runs","run_tag":null,"print_config":false,"data":"fineweb_1b.npy","data_format":"npy","data_dtype":"uint16","vocab_size":50257,"val_frac":0.1,"out_dir":"runs/1b_train_decoupled_fast","seed":1337,"device":null,"compile":true,"compile_mode":"reduce-overhead","amp":true,"amp_dtype":"bf16","param_dtype":"bf16","matmul_precision":"high","layers":18,"d_model":2048,"n_head":16,"d_ff":8192,"block":2048,"embed_dim":2048,"attn_mode":"decoupled","kv_head":null,"attn_dim":768,"sem_dim":256,"geo_dim":512,"no_rope":false,"rope":false,"rope_base":10000.0,"tie_qk":true,"no_tie_qk":false,"null_attn":false,"no_null_attn":false,"no_learned_temp":false,"mlp":"swiglu","dropout":0.0,"steps":50,"batch_size":32,"grad_accum":2,"train_seq_len":512,"seq_schedule":null,"eval_seq_len":0,"grad_checkpoint":true,"optimizer":"lion","adam_betas":"0.9,0.95","adam_eps":1e-08,"lion_betas":"0.9,0.99","lr":0.0001,"lr_schedule":"cosine","warmup_steps":200,"min_lr":0.0,"opt_foreach":true,"opt_fused":false,"weight_decay":0.1,"grad_clip":1.0,"save_every":0,"eval_every":0,"eval_iters":20,"log_every":1,"instrument":"basic","analysis_every":0,"analysis_max_tokens":256,"analysis_layers":"0,-1","analysis_heads":"0","analysis_topk":8,"analysis_local_window":32,"analysis_save_scores":false,"live":"auto","live_update_every":1,"sync_timing":false,"live_plot":false,"tb":false,"mode":"train","ckpt":null,"prompt_tokens":"0","max_new_tokens":50,"temperature":1.0,"top_k":null,"kv_cache":"fp16","kv_qblock":32,"kv_residual":128,"kv_decode_block":1024,"kv_fused":"auto","self_opt":"none","self_opt_cache":null,"self_opt_decode_blocks":"256,512,1024,2048","self_opt_block_n":"128","self_opt_warps":"4,8","self_opt_stages":"2,3","self_opt_warmup":1,"self_opt_iters":3,"self_opt_interval":256,"self_opt_hysteresis":0.03,"self_opt_verbose":false,"self_opt_verify":false,"self_opt_verify_tol":0.005,"self_opt_scope":"all","self_opt_residuals":"0,32,64,128","self_opt_qblocks":"16,32,64","self_opt_k_sem_kinds":"q4_0,nf4,q8_0,fp16","self_opt_k_geo_kinds":"q8_0,q4_0,fp16","self_opt_v_kinds":"q4_0,q8_0,fp16","self_opt_mem_budget_mb":null,"self_opt_mem_overhead_frac":0.1,"self_opt_policy_prefix_len":null,"self_opt_policy_warmup":1,"self_opt_policy_iters":3,"self_opt_policy_hysteresis":0.02,"self_opt_prefer_low_mem_within":0.02,"self_opt_policy_quality":false,"self_opt_calib_tokens":null,"self_opt_calib_prefill":128,"self_opt_calib_decode":32,"self_opt_quality_tol":0.5,"self_opt_quality_delta_nll_tol":0.02,"self_opt_quality_ppl_ratio_tol":1.02,"self_opt_quality_kl_tol":null,"self_opt_quality_kl":false,"kv_cache_k":null,"kv_cache_v":null,"kv_cache_k_sem":null,"kv_cache_k_geo":null,"kv_qblock_k":null,"kv_qblock_v":null,"kv_qblock_k_sem":null,"kv_qblock_k_geo":null,"tokenizer":"word"},"config":{"vocab_size":50257,"block_size":2048,"n_layer":18,"n_head":16,"kv_head":null,"d_model":2048,"d_ff":8192,"embed_dim":2048,"attn_mode":"decoupled","attn_dim":768,"sem_dim":256,"geo_dim":512,"rope":true,"rope_base":10000.0,"tie_qk":true,"null_attn":false,"learned_temp":true,"mlp":"swiglu","dropout":0.0},"wall_time":"2025-12-18T12:36:49+01:00"}
{"type":"mem","step":0,"kv_ctx_bytes":113246208,"kv_128k_bytes":7077888000,"data_format":"npy","data_dtype":"uint16","n_tokens_total":1000000000,"n_tokens_train":900000000,"n_tokens_val":100000000,"vocab_size":50257,"wall_time":"2025-12-18T12:36:49+01:00"}
{"type":"train","step":1,"loss":11.231095314025879,"ppl":75440.18080866331,"lr":5e-07,"tok_s":1322.359134013628,"seq_len":512,"grad_accum":2,"global_batch":64,"step_ms":24779.95512500638,"data_ms":13.173083018045872,"fwd_ms":5907.615792006254,"bwd_ms":18075.055584020447,"opt_ms":783.6612079991028,"grad_clip_norm":4.375,"opt_state_bytes":2187964992,"mps_mem_alloc_bytes":14597783808.0,"mps_mem_driver_bytes":34525478912.0,"cpu_rss_bytes":4940644352.0,"grad_norm_embed":0.0,"grad_norm_attn":0.6227178617244419,"grad_norm_ffn":0.6406982935742741,"grad_norm_attn_sem":0.041760916500328156,"grad_norm_attn_geo":0.031246470544127172,"grad_norm_total":0.8949816505203111,"wall_time":"2025-12-18T12:37:14+01:00"}
{"type":"train","step":2,"loss":11.223544120788574,"ppl":74872.66284111739,"lr":1e-06,"tok_s":1343.8938608930455,"seq_len":512,"grad_accum":2,"global_batch":64,"step_ms":24382.877958996687,"data_ms":40.45387398218736,"fwd_ms":5621.3439159910195,"bwd_ms":17981.63370898692,"opt_ms":738.7119169579819,"grad_clip_norm":4.3125,"opt_state_bytes":2187964992,"mps_mem_alloc_bytes":14243131392.0,"mps_mem_driver_bytes":34525478912.0,"cpu_rss_bytes":4946280448.0,"grad_norm_embed":0.0,"grad_norm_attn":0.6217827303724214,"grad_norm_ffn":0.6449150512095383,"grad_norm_attn_sem":0.03902966853641897,"grad_norm_attn_geo":0.030985711710880548,"grad_norm_total":0.897224953076026,"wall_time":"2025-12-18T12:37:38+01:00"}
{"type":"train","step":3,"loss":11.247053146362305,"ppl":76653.69937634775,"lr":1.5e-06,"tok_s":1353.4553178248773,"seq_len":512,"grad_accum":2,"global_batch":64,"step_ms":24210.62562498264,"data_ms":39.97554205125198,"fwd_ms":5511.9910829816945,"bwd_ms":17923.36883401731,"opt_ms":734.5311249955557,"grad_clip_norm":4.375,"opt_state_bytes":2187964992,"mps_mem_alloc_bytes":12896333824.0,"mps_mem_driver_bytes":37820104704.0,"cpu_rss_bytes":4951441408.0,"grad_norm_embed":0.0,"grad_norm_attn":0.6212273948423386,"grad_norm_ffn":0.6424512004750451,"grad_norm_attn_sem":0.0399529894808947,"grad_norm_attn_geo":0.030265513714015875,"grad_norm_total":0.8950861767356589,"wall_time":"2025-12-18T12:38:03+01:00"}
{"type":"train","step":4,"loss":11.21841049194336,"ppl":74489.27929583006,"lr":2e-06,"tok_s":1343.242071054298,"seq_len":512,"grad_accum":2,"global_batch":64,"step_ms":24394.709416956175,"data_ms":40.23154097376391,"fwd_ms":5543.33754099207,"bwd_ms":18075.77462500194,"opt_ms":734.62354199728,"grad_clip_norm":4.4375,"opt_state_bytes":2187964992,"mps_mem_alloc_bytes":12875030528.0,"mps_mem_driver_bytes":37820104704.0,"cpu_rss_bytes":4954898432.0,"grad_norm_embed":0.0,"grad_norm_attn":0.6246557600906026,"grad_norm_ffn":0.6467304549668764,"grad_norm_attn_sem":0.04095584475120142,"grad_norm_attn_geo":0.03044927160677976,"grad_norm_total":0.9005884961272265,"wall_time":"2025-12-18T12:38:27+01:00"}
{"type":"train","step":5,"loss":11.225173950195312,"ppl":74994.79200659455,"lr":2.5e-06,"tok_s":1326.0621478626322,"seq_len":512,"grad_accum":2,"global_batch":64,"step_ms":24710.75737499632,"data_ms":41.45900101866573,"fwd_ms":5612.361958948895,"bwd_ms":18308.05600003805,"opt_ms":748.1124999467283,"grad_clip_norm":4.28125,"opt_state_bytes":2187964992,"mps_mem_alloc_bytes":12724035584.0,"mps_mem_driver_bytes":37820104704.0,"cpu_rss_bytes":4956635136.0,"grad_norm_embed":0.0,"grad_norm_attn":0.6183523243493749,"grad_norm_ffn":0.6375197440268413,"grad_norm_attn_sem":0.03995670144897322,"grad_norm_attn_geo":0.031146258472322944,"grad_norm_total":0.8895828508125765,"wall_time":"2025-12-18T12:38:52+01:00"}
{"type":"train","step":6,"loss":11.235970497131348,"ppl":75808.86347113986,"lr":3e-06,"tok_s":1255.6770792035813,"seq_len":512,"grad_accum":2,"global_batch":64,"step_ms":26095.881292014383,"data_ms":45.71304196724668,"fwd_ms":5971.100665978156,"bwd_ms":19253.04166699061,"opt_ms":825.2434589667246,"grad_clip_norm":4.46875,"opt_state_bytes":2187964992,"mps_mem_alloc_bytes":12724035584.0,"mps_mem_driver_bytes":37820104704.0,"cpu_rss_bytes":4961484800.0,"grad_norm_embed":0.0,"grad_norm_attn":0.6212222195158597,"grad_norm_ffn":0.6404769084996339,"grad_norm_attn_sem":0.03882665517644777,"grad_norm_attn_geo":0.030500398104415856,"grad_norm_total":0.8936249211935499,"wall_time":"2025-12-18T12:39:18+01:00"}
{"type":"train","step":7,"loss":11.225109100341797,"ppl":74989.92876301051,"lr":3.5e-06,"tok_s":1267.2995954246182,"seq_len":512,"grad_accum":2,"global_batch":64,"step_ms":25856.553666002583,"data_ms":46.35841801064089,"fwd_ms":5920.891333022155,"bwd_ms":19126.619583985303,"opt_ms":761.743958981242,"grad_clip_norm":4.25,"opt_state_bytes":2187964992,"mps_mem_alloc_bytes":12724035584.0,"mps_mem_driver_bytes":37820104704.0,"cpu_rss_bytes":4964548608.0,"grad_norm_embed":0.0,"grad_norm_attn":0.6191678462851267,"grad_norm_ffn":0.6538454682431729,"grad_norm_attn_sem":0.03922507235334182,"grad_norm_attn_geo":0.03098990399095241,"grad_norm_total":0.901876764677963,"wall_time":"2025-12-18T12:39:44+01:00"}
